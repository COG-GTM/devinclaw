# Knowledge: guardrail-auditor

## Overview
Monitor and enforce Devin Enterprise guardrail compliance across all active sessions. Polls the Guardrails API for violations, logs findings to the audit trail, alerts the team on any breach, and blocks non-compliant work from merging. Use this skill as a continuous governance layer during any modernization campaign.

## What's Needed From User
- **Devin Enterprise API key**: Service user credential with `ManageEnterpriseSettings` permission
- **Guardrail configuration**: Which guardrails are active (defined in `audit/guardrail-config.json`)
- **Alert channel**: Where to send violation notifications (Slack channel, Teams channel, or email)
- **Enforcement mode**: `monitor` (log only) or `enforce` (block non-compliant PRs)
- **Polling interval** (optional): How frequently to check for violations (default: every 5 minutes)

## Procedure
1. **Load guardrail configuration**
 - Read `audit/guardrail-config.json` for active guardrail rules
 - Verify Devin Enterprise API connectivity with a test call
 - Confirm service user has `ManageEnterpriseSettings` permission
 - Log audit start event with timestamp and configuration hash

2. **Poll for guardrail violations**
 - Call `GET /v3beta1/enterprise/guardrail-violations` with time window filter
 - Parameters: `time_after` = last poll timestamp, `order` = asc, `first` = 200
 - Paginate through all results if `has_next_page` is true
 - Parse each violation: session_id, guardrail_id, timestamp, details

3. **Classify violation severity**
 - **CRITICAL**: Security guardrails (credentials in code, unauthorized network access, data exfiltration attempts)
 - **HIGH**: Quality guardrails (tests not written, spec not followed, forbidden file modifications)
 - **MEDIUM**: Process guardrails (PR description missing, commit message format, branch naming)
 - **LOW**: Style guardrails (formatting, naming conventions)

4. **Log to audit trail**
 - Write each violation to `audit/violations/YYYY-MM-DD.json` in structured format:
 ```json
 {
 "timestamp": "ISO-8601",
 "session_id": "devin-session-id",
 "guardrail_id": "guardrail-rule-id",
 "severity": "CRITICAL|HIGH|MEDIUM|LOW",
 "description": "What was violated",
 "action_taken": "logged|alerted|blocked",
 "resolved": false
 }
 ```
 - Append to running daily log — never overwrite

5. **Alert on violations**
 - CRITICAL: Immediate alert to all configured channels + attempt to pause the session
 - HIGH: Alert to primary channel within 1 minute
 - MEDIUM: Batch alerts every 15 minutes
 - LOW: Include in daily summary report only
 - Alert format: `[GUARDRAIL VIOLATION] Severity: {X} | Session: {id} | Rule: {name} | Details: {description}`

6. **Enforce compliance (if enforcement mode is active)**
 - For CRITICAL/HIGH violations: add a comment to the associated PR requesting fix before merge
 - For sessions with 3+ unresolved violations: flag session for human review
 - Block merge of any PR with unresolved CRITICAL findings
 - Maintain a compliance scorecard per session and per engineer

7. **Generate compliance reports**
 - Daily summary: total sessions, total violations by severity, resolution rate, top violated rules
 - Weekly trend: violation rate over time, improving/degrading areas, engineer compliance scores
 - On-demand: full audit export for regulatory compliance reviews (JSON + CSV formats)

8. **Validate SDLC completion**
 - Cross-reference with `audit/sdlc-checklist.json` for every completed session:
 - [ ] SDD spec document exists in PR
 - [ ] TDD test plan exists
 - [ ] All tests passing
 - [ ] Devin Review completed with no unresolved CRITICAL bugs
 - [ ] Guardrails: zero CRITICAL/HIGH violations
 - [ ] Security scan completed
 - Sessions missing any checklist item are flagged as incomplete

## Specifications
- **Polling interval**: Configurable, default 5 minutes, minimum 1 minute
- **Retention**: Violation logs retained indefinitely (enterprise audit requirement)
- **API pagination**: Handle up to 10,000 violations per polling cycle
- **Time window**: Maximum 100-day lookback per API call (Devin API constraint)
- **Concurrency**: Single auditor instance per DevinClaw deployment (avoid duplicate alerts)
- **Idempotency**: Track last processed violation cursor to avoid re-processing

## Advice and Pointers
- Start in `monitor` mode for the first week to establish baseline violation rates before switching to `enforce`
- The most common violations in migration campaigns are: missing test coverage, hardcoded connection strings from copied legacy code, and overly broad file access patterns
- Keep guardrail rules specific and actionable — vague rules generate false positives that erode trust in the system
- Review and tune guardrail rules weekly based on violation patterns — too many LOW violations create alert fatigue
- Enterprise auditors will ask for the violation log during compliance certification reviews — ensure the log format is clean and queryable

## Forbidden Actions
- Do not delete or modify violation log entries — audit logs are immutable
- Do not disable guardrails without explicit human authorization logged in the audit trail
- Do not automatically resolve violations — only humans can mark violations as resolved
- Do not expose API credentials in violation reports or alerts
- Do not skip polling cycles — if the API is unavailable, log the outage and retry with exponential backoff

---
*Generated by DevinClaw Skills Parser at 2026-02-25T06:27:28Z*
*Source: skills/guardrail-auditor/SKILL.md*
