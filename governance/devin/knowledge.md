# Enterprise Security Compliance Knowledge for DevinClaw

> Copy this entire file to your Devin Knowledge base. Adapted for DevinClaw enterprise ederal modernization.

## Overview

All code generated by Devin agents within DevinClaw must comply with CIS Benchmark and SOC 2 / ISO 27001 security standards. This knowledge ensures secure coding practices for the enterprise systems modernization.

---

## Core Security Rules

### 1. Input Validation (CIS Benchmark INPUT-001)
**Always validate ALL user inputs using whitelist approach:**
- Validate email format with regex
- Validate numeric ranges
- Enforce length limits (max 255 chars default)
- Reject unknown/unexpected input patterns

```python
# Example: Validate before processing
if not re.match(r'^[a-zA-Z0-9_-]+$', username):
 return error("Invalid username format")
```

### 2. Input Sanitization (CIS Benchmark SEC-XXX)
**Remove dangerous characters to prevent injection:**
- Remove: `< > " ' ; & | $ ( ) \``
- Use parameterized queries for databases
- Encode output to prevent XSS

```python
# Example: Sanitize user input
sanitized = re.sub(r'[<>"\';&|`$()]', '', user_input.strip())
```

### 3. Authentication (CIS Benchmark AUTH-001)
**Password requirements:**
- Minimum 14 characters
- Must include: uppercase, lowercase, digit, special character
- Hash with bcrypt (12 rounds minimum)
- Never store plaintext passwords

```python
# Example: Hash password
import bcrypt
hashed = bcrypt.hashpw(password.encode(), bcrypt.gensalt(rounds=12))
```

### 4. Account Lockout (CIS Benchmark AUTH-001)
- Lock account after 5 failed login attempts
- 15-minute lockout duration
- Log all failed attempts

### 5. Session Security (CIS Benchmark SESS-001)
- Session timeout: 15 minutes inactivity
- Secure cookie flags: `Secure`, `HttpOnly`, `SameSite=Strict`
- Regenerate session ID after login

### 6. Encryption (CIS Benchmark CRYPTO-001, TLS-001)
- **At rest:** AES-256
- **In transit:** TLS 1.2+ only
- **Never hardcode secrets** -- use environment variables

### 7. Audit Logging (CIS Benchmark AUDIT-001)
**Log these events in JSON format:**
- Authentication (success/failure)
- Authorization failures
- Data access/modification
- Admin actions

```python
# Example: Audit log entry
{
 "timestamp": "2026-02-24T19:30:00Z",
 "event": "authentication_failure",
 "user": "john.doe",
 "ip": "192.168.1.1",
 "reason": "invalid_password"
}
```

### 8. Security Headers (CIS Benchmark HEADERS-001)
**Every HTTP response must include:**
```
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
Content-Security-Policy: default-src 'self'
```

### 9. Error Handling (CIS Benchmark HEADERS-001)
- Return generic messages to users: "An error occurred"
- Log detailed errors internally with stack traces
- Never expose internal details to users

---

## CIS Benchmark to security Quick Reference

| CIS Benchmark | security | What to Implement |
|------|------|-------------------|
| AUTH-001 | multi-factor authentication, authenticator management | MFA, password policy, bcrypt |
| SESS-001 | unsuccessful login attempts, AC-12 | Lockout (5 attempts), timeout (15 min) |
| INPUT-001 | input validation | Whitelist input validation |
| SEC-XXX | input validation | Parameterized queries, sanitization |
| CRYPTO-001 | encryption at rest | AES-256 encryption at rest |
| TLS-001 | encryption in transit | TLS 1.2+ in transit |
| AUDIT-001 | audit logging, audit logging | JSON audit logging |
| HEADERS-001 | SI-11 | Security headers, generic errors |

---

## Code Patterns

### Secure Flask Route
```python
@app.route("/api/data", methods=["POST"])
def handle_data():
 # 1. Get client IP for logging
 client_ip = request.remote_addr

 # 2. Validate input
 data = request.get_json()
 if not data or 'field' not in data:
 log_security_event("validation_failure", client_ip)
 return jsonify({"error": "Invalid request"}), 400

 # 3. Sanitize input
 safe_field = sanitize_string(data['field'])
 if not safe_field:
 return jsonify({"error": "Invalid data"}), 400

 # 4. Process and log
 log_security_event("data_access", client_ip, {"action": "read"})
 return jsonify({"status": "ok"})
```

### Secure Database Query
```python
# CORRECT - Parameterized query
cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))

# WRONG - SQL injection vulnerable
cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")
```

---

## Pre-Completion Checklist

Before completing any code task:
- [ ] All user inputs validated (whitelist)
- [ ] All user inputs sanitized
- [ ] No hardcoded secrets
- [ ] Parameterized database queries
- [ ] Security events logged
- [ ] Generic error messages to users
- [ ] Security headers on responses

---

**Adapted from:** enterprise_security_compliance reference for DevinClaw enterprise modernization
